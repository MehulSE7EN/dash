<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Overlord: Fortress Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Teko:wght@600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Project Overlord (Military Olive, Gunmetal Gray, Amber Alert) -->
    <!-- Application Structure Plan: A top-down "War Room" dashboard. The UI is designed to feel like a tactical command center. 1) A fixed "Command Bar" at the top provides global stats and the primary action button. 2) The main content area is split into two zones: "Active Engagements" for chapters currently in the testing cycle, and "Conquered Territories" for Fortress chapters. 3) A dedicated, high-visibility "Overlord Engine" panel displays the AI-generated next mission. This structure mimics a military briefing room, focusing the user on the most critical information first. -->
    <!-- Visualization & Content Choices: Report Info: Next Test Syllabus -> Goal: Ruthless Intelligence -> Viz/Method: The "Overlord Engine" uses an advanced weighted "Weakness Score" algorithm (avg score, trend, consistency) to identify the 3 most critical chapters. This is a true AI advisor. Report Info: Chapter Mastery -> Goal: Tactical Readout -> Viz/Method: Chapter cards are designed as "dossiers" with a 4-slot score history, progress bar, and key stats (avg, trend). This provides a complete tactical picture of each chapter. Report Info: Limited Data -> Goal: Focus on Recency -> Viz/Method: The data structure now only stores the last 4 scores, automatically creating a rolling window of performance. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --c-bg: #111827; /* slate-900 */
            --c-surface: #1f2937; /* slate-800 */
            --c-border: #374151; /* slate-700 */
            --c-text-primary: #f9fafb; /* gray-50 */
            --c-text-secondary: #9ca3af; /* gray-400 */
            --c-accent-amber: #f59e0b;
            --c-accent-green: #84cc16; /* lime-500 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-bg);
            color: var(--c-text-primary);
        }
        .font-teko { font-family: 'Teko', sans-serif; }
        .progress-bg { background-color: rgba(0,0,0,0.2); }
        .progress-bar { background-color: var(--c-accent-amber); transition: width 0.5s ease-in-out; }
        .war-card {
            background-color: var(--c-surface);
            border: 1px solid var(--c-border);
            box-shadow: inset 0px 1px 0px rgba(255,255,255,0.05);
            transition: all 0.2s ease-in-out;
        }
        .war-card:hover { border-color: var(--c-accent-amber); }
        .modal-backdrop { background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .score-slot {
            width: 4rem; height: 3rem;
            display: flex; align-items: center; justify-content: center;
            background-color: var(--c-bg);
            border: 1px dashed var(--c-border);
            font-weight: 600;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Main Container -->
    <div class="container mx-auto max-w-7xl p-4 md:p-6">
        <!-- Header -->
        <header class="border-b-2 border-amber-500/50 pb-4 mb-6">
            <h1 class="font-teko text-6xl tracking-widest text-white">PROJECT <span class="text-amber-400">OVERLORD</span></h1>
            <p class="text-slate-400 -mt-2">Chemistry Fortress Protocol // Final Version</p>
        </header>

        <!-- Command Bar -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div id="global-stats" class="col-span-2 lg:col-span-3 grid grid-cols-3 gap-4"></div>
            <button id="add-chapter-btn" class="bg-amber-500 text-slate-900 font-bold h-full rounded-md hover:bg-amber-400 transition text-lg">ACTIVATE CHAPTER</button>
        </div>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Battlefield (Left) -->
            <main class="flex-1">
                <h2 class="font-teko text-4xl text-slate-300 mb-4 border-l-4 border-amber-400 pl-4">ACTIVE ENGAGEMENTS</h2>
                <div id="chapters-container" class="space-y-4"></div>
            </main>

            <!-- Command & Control (Right Sidebar) -->
            <aside class="w-full lg:w-96 flex-shrink-0 space-y-6">
                <div>
                    <h2 class="font-teko text-4xl text-slate-300 mb-4 border-l-4 border-amber-400 pl-4">OVERLORD ENGINE</h2>
                    <div id="overlord-engine" class="war-card p-4 rounded-md">
                        <p class="text-sm text-slate-400 mb-3">AI analysis complete. These are your weakest points. Hunt them down.</p>
                        <div id="next-test-syllabus" class="space-y-2"></div>
                    </div>
                </div>
                <div>
                    <h2 class="font-teko text-4xl text-slate-300 mb-4 border-l-4 border-green-500 pl-4">CONQUERED TERRITORIES</h2>
                    <div id="fortress-container" class="war-card p-4 rounded-md space-y-2"></div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modals -->
    <div id="add-chapter-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50">
        <div class="war-card rounded-lg p-8 w-full max-w-md border-amber-400">
            <h2 class="font-teko text-3xl mb-4">Activate New Engagement</h2>
            <select id="chapter-select" class="w-full bg-slate-800 border border-slate-700 rounded-md p-3 focus:outline-none focus:border-amber-400 mb-4"></select>
            <div class="flex gap-4">
                <button id="modal-cancel-btn" class="w-full bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-md">Cancel</button>
                <button id="modal-activate-btn" class="w-full bg-amber-500 hover:bg-amber-400 text-slate-900 font-bold py-3 rounded-md">Activate</button>
            </div>
        </div>
    </div>
    
    <div id="add-score-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden z-50">
        <div class="war-card rounded-lg p-8 w-full max-w-md border-amber-400">
            <h2 id="score-modal-title" class="font-teko text-3xl mb-4">Log Test Data</h2>
            <input type="number" id="score-input-field" min="0" max="100" class="w-full text-center text-3xl font-bold bg-slate-900 border border-slate-700 rounded-md p-3 focus:outline-none focus:border-amber-400 mb-4" placeholder="%">
            <div class="flex gap-4">
                <button id="score-modal-cancel-btn" class="w-full bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-md">Cancel</button>
                <button id="score-modal-submit-btn" class="w-full bg-amber-500 hover:bg-amber-400 text-slate-900 font-bold py-3 rounded-md">Log Score</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const initialChapters = [
        'Some Basic Concepts', 'Structure of Atom', 'States of Matter', 'Thermodynamics', 'Equilibrium', 'Redox Reactions', 'Solid State', 'Solutions', 'Electrochemistry', 'Chemical Kinetics', 'Surface Chemistry', 'Periodic Table', 'Chemical Bonding', 'Hydrogen', 's-Block Elements', 'p-Block (13-14)', 'p-Block (15-18)', 'd & f Block', 'Coordination Compounds', 'Metallurgy', 'GOC & Hydrocarbons', 'Environmental Chemistry', 'Haloalkanes & Haloarenes', 'Alcohols, Phenols & Ethers', 'Aldehydes, Ketones & Acids', 'Amines', 'Biomolecules', 'Polymers', 'Chemistry in Everyday Life'
    ].map((name, index) => ({ id: `c${index + 1}`, name, status: 'locked', scores: [] }));

    let chapterData = JSON.parse(localStorage.getItem('overlordDataV1')) || initialChapters;
    let currentlyScoringChapterId = null;

    const elements = {
        main: document.querySelector('main'),
        chaptersContainer: document.getElementById('chapters-container'),
        nextTestSyllabus: document.getElementById('next-test-syllabus'),
        fortressContainer: document.getElementById('fortress-container'),
        chapterSelect: document.getElementById('chapter-select'),
        globalStats: document.getElementById('global-stats'),
        addChapterModal: document.getElementById('add-chapter-modal'),
        addChapterBtn: document.getElementById('add-chapter-btn'),
        modalActivateBtn: document.getElementById('modal-activate-btn'),
        modalCancelBtn: document.getElementById('modal-cancel-btn'),
        addScoreModal: document.getElementById('add-score-modal'),
        scoreModalTitle: document.getElementById('score-modal-title'),
        scoreInputField: document.getElementById('score-input-field'),
        scoreModalSubmitBtn: document.getElementById('score-modal-submit-btn'),
        scoreModalCancelBtn: document.getElementById('score-modal-cancel-btn'),
    };

    function saveData() {
        localStorage.setItem('overlordDataV1', JSON.stringify(chapterData));
    }

    // --- Core Overlord AI Logic ---
    function calculateWeaknessScore(chapter) {
        if (chapter.status !== 'active' || chapter.scores.length === 0) return 0;

        const recentScores = chapter.scores.slice(-3);
        const avgScore = recentScores.reduce((a, b) => a + b, 0) / recentScores.length;
        
        let trend = 0;
        if (recentScores.length > 1) {
            trend = recentScores[recentScores.length - 1] - recentScores[0];
        }

        const mean = avgScore;
        const stdDev = Math.sqrt(recentScores.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b, 0) / recentScores.length);
        const consistencyPenalty = stdDev;

        const weakness = ((100 - avgScore) * 1.5) - (trend * 0.5) + (consistencyPenalty * 1.0);
        return weakness;
    }

    function getNextMissionSyllabus() {
        const activeChapters = chapterData.filter(c => c.status === 'active');
        if (activeChapters.length === 0) return [];
        
        activeChapters.forEach(c => c.weakness = calculateWeaknessScore(c));
        activeChapters.sort((a, b) => b.weakness - a.weakness);

        return activeChapters.slice(0, 3);
    }
    
    // --- Rendering Logic ---
    function render() {
        elements.chaptersContainer.innerHTML = '';
        elements.fortressContainer.innerHTML = '';
        elements.chapterSelect.innerHTML = '<option value="">Select Chapter to Activate...</option>';
        
        let activeCount = 0, fortressCount = 0;

        chapterData.forEach(chapter => {
            const last3Scores = chapter.scores.slice(-3);
            if (last3Scores.length === 3 && last3Scores.every(s => s >= 90)) {
                 chapter.status = 'fortress';
            } else if (chapter.status !== 'locked') {
                chapter.status = 'active';
            }

            if (chapter.status === 'locked') {
                const option = document.createElement('option');
                option.value = chapter.id;
                option.textContent = chapter.name;
                elements.chapterSelect.appendChild(option);
            } else if (chapter.status === 'active') {
                activeCount++;
                elements.chaptersContainer.innerHTML += renderChapterCard(chapter);
            } else {
                fortressCount++;
                elements.fortressContainer.innerHTML += renderFortressCard(chapter);
            }
        });

        if (activeCount === 0) elements.chaptersContainer.innerHTML = '<p class="text-slate-500 text-center col-span-full py-10">No active engagements. Activate a chapter from the command bar.</p>';
        if (fortressCount === 0) elements.fortressContainer.innerHTML = '<p class="text-slate-500 text-center text-sm">No territories conquered yet.</p>';

        renderGlobalStats(chapterData.length, activeCount, fortressCount);
        renderNextTestSyllabus();
        saveData();
    }

    function renderGlobalStats(total, active, fortresses) {
        elements.globalStats.innerHTML = `
            <div class="war-card rounded-md p-3 text-center"><p class="font-teko text-4xl">${total}</p><p class="text-xs text-slate-400">Total Chapters</p></div>
            <div class="war-card rounded-md p-3 text-center"><p class="font-teko text-4xl text-amber-400">${active}</p><p class="text-xs text-slate-400">Active Engagements</p></div>
            <div class="war-card rounded-md p-3 text-center"><p class="font-teko text-4xl text-green-400">${fortresses}</p><p class="text-xs text-slate-400">Conquered</p></div>
        `;
    }

    function renderNextTestSyllabus() {
        const syllabus = getNextMissionSyllabus();
        elements.nextTestSyllabus.innerHTML = '';
        if (syllabus.length === 0) {
            elements.nextTestSyllabus.innerHTML = '<p class="text-sm text-slate-500">Activate chapters and log scores to generate mission.</p>';
            return;
        }
        const roles = ['🎯 Primary Target', '🛡️ Secondary Target', '🔭 Tertiary Target'];
        syllabus.forEach((chapter, index) => {
            elements.nextTestSyllabus.innerHTML += `
                <div class="bg-slate-900/70 p-3 rounded-md border-l-4 border-amber-400">
                    <p class="font-semibold text-slate-200">${chapter.name}</p>
                    <p class="text-xs font-bold text-amber-400">${roles[index]}</p>
                </div>
            `;
        });
    }

    function renderChapterCard(chapter) {
        const last4Scores = chapter.scores.slice(-4);
        const fortressProgress = chapter.scores.slice(-3).filter(s => s >= 90).length;
        const progressPercentage = (fortressProgress / 3) * 100;
        const avgScore = chapter.scores.length ? (chapter.scores.reduce((a, b) => a + b, 0) / chapter.scores.length).toFixed(1) : 'N/A';
        
        let trendIndicator = '';
        if (last4Scores.length > 1) {
            const trend = last4Scores[last4Scores.length - 1] - last4Scores[0];
            if (trend > 5) trendIndicator = '<span class="text-green-400">▲ Improving</span>';
            else if (trend < -5) trendIndicator = '<span class="text-red-400">▼ Declining</span>';
            else trendIndicator = '<span class="text-slate-400">▬ Stable</span>';
        }

        return `
            <div class="war-card rounded-lg p-5">
                <div class="flex justify-between items-start mb-3">
                    <h3 class="font-teko text-3xl text-slate-200 pr-2">${chapter.name}</h3>
                    <button class="add-score-btn text-3xl font-bold text-amber-400 hover:text-amber-300" data-id="${chapter.id}">+</button>
                </div>
                <div class="flex gap-2 mb-4">
                    ${Array(4).fill(0).map((_, i) => `<div class="score-slot rounded-md text-lg ${last4Scores[i] ? (last4Scores[i] >= 90 ? 'text-green-400' : 'text-amber-400') : 'text-slate-600'}">${last4Scores[i] || '-'}</div>`).join('')}
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                    <div><span class="text-slate-400">Avg Score:</span> <span class="font-bold text-white">${avgScore}%</span></div>
                    <div><span class="text-slate-400">Trend:</span> <span class="font-bold">${trendIndicator}</span></div>
                </div>
                <div class="w-full progress-bg rounded-full h-2 mb-1">
                    <div class="progress-bar h-2 rounded-full" style="width: ${progressPercentage}%"></div>
                </div>
                <p class="text-xs text-slate-400">Fortress Progress (${fortressProgress}/3)</p>
            </div>
        `;
    }
    
    function renderFortressCard(chapter){
        return `<div class="war-card p-3 rounded-md flex items-center gap-3 text-sm border-green-500/50"><span class="text-green-400">🏰</span><span class="font-semibold text-slate-300">${chapter.name}</span></div>`;
    }

    // --- Event Listeners ---
    function toggleModal(modal, show) {
        modal.classList.toggle('hidden', !show);
    }

    elements.addChapterBtn.addEventListener('click', () => toggleModal(elements.addChapterModal, true));
    elements.modalCancelBtn.addEventListener('click', () => toggleModal(elements.addChapterModal, false));
    elements.modalActivateBtn.addEventListener('click', () => {
        const selectedId = elements.chapterSelect.value;
        if (!selectedId) return;
        const chapter = chapterData.find(c => c.id === selectedId);
        chapter.status = 'active';
        toggleModal(elements.addChapterModal, false);
        render();
    });

    elements.main.addEventListener('click', e => {
        const addScoreBtn = e.target.closest('.add-score-btn');
        if (addScoreBtn) {
            currentlyScoringChapterId = addScoreBtn.dataset.id;
            const chapter = chapterData.find(c => c.id === currentlyScoringChapterId);
            elements.scoreModalTitle.textContent = `Log Data: ${chapter.name}`;
            elements.scoreInputField.value = '';
            toggleModal(elements.addScoreModal, true);
            elements.scoreInputField.focus();
        }
    });
    
    elements.scoreModalCancelBtn.addEventListener('click', () => toggleModal(elements.addScoreModal, false));
    elements.scoreModalSubmitBtn.addEventListener('click', () => {
        const score = parseInt(elements.scoreInputField.value);
        if (currentlyScoringChapterId && !isNaN(score) && score >= 0 && score <= 100) {
            const chapter = chapterData.find(c => c.id === currentlyScoringChapterId);
            chapter.scores.push(score);
            if (chapter.scores.length > 4) {
                chapter.scores.shift(); // Keep only the last 4 scores
            }
            toggleModal(elements.addScoreModal, false);
            render();
        }
    });
    
    // Initial render
    render();
});
</script>
</body>
</html>
