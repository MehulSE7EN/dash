<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Chimera: Fortress Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Teko:wght@600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Project Chimera (Deep Space, Quantum Blue, Neon Magenta) -->
    <!-- Application Structure Plan: A multi-pane, high-density information dashboard. The UI is designed for strategic overview and rapid decision-making. 1) A top "Global Stats" bar provides an instant pulse of the campaign. 2) The main view is a two-column layout. The left is the "Battlefield," a scrollable list of all active chapters as data-rich cards. The right is the fixed "Command & Control" sidebar. 3) The C&C sidebar contains the most critical component: the "Chimera Engine," which displays the AI-generated next mission, and the "Fortress Hall" for conquered chapters. This structure separates tactical data from strategic directives, providing clarity and empowering the user. -->
    <!-- Visualization & Content Choices: Report Info: Next Test Syllabus -> Goal: True Intelligence -> Viz/Method: The "Chimera Engine" uses a weighted "Weakness Score" algorithm (avg score, recency, attempts) to identify and rank the top 3 most critical chapters for the next test. This is a true AI advisor. Report Info: Chapter Mastery -> Goal: At-a-Glance Performance -> Viz/Method: Chapter cards feature a 3-stage progress bar, a mini sparkline chart for score history, and clear stats (avg score, attempts). This provides a rich, immediate understanding of each chapter's status. Report Info: Chapter Management -> Goal: Streamlined Workflow -> Viz/Method: A modal-based system for adding chapters and scores, keeping the main interface clean. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --c-bg: #020617; /* slate-950 */
            --c-surface: #0f172a; /* slate-900 */
            --c-border: #1e293b; /* slate-800 */
            --c-text-primary: #e2e8f0; /* slate-200 */
            --c-text-secondary: #94a3b8; /* slate-400 */
            --c-accent-cyan: #22d3ee;
            --c-accent-magenta: #f472b6;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--c-bg);
            color: var(--c-text-primary);
        }
        .font-teko { font-family: 'Teko', sans-serif; }
        .progress-bg { background-color: var(--c-border); }
        .progress-bar { background-color: var(--c-accent-cyan); transition: width 0.5s ease-in-out; }
        .chimera-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.2));
            border: 1px solid var(--c-border);
            backdrop-filter: blur(10px);
            transition: all 0.2s ease-in-out;
        }
        .chimera-card:hover {
            border-color: var(--c-accent-cyan);
            transform: translateY(-4px);
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="h-screen overflow-hidden">
    <!-- Main Container -->
    <div class="flex flex-col h-full">
        <!-- Header -->
        <header class="flex-shrink-0 bg-slate-950/70 backdrop-blur-sm border-b border-slate-800 px-6 py-3 flex justify-between items-center">
            <h1 class="font-teko text-4xl tracking-widest text-white">PROJECT <span class="text-cyan-400">CHIMERA</span></h1>
            <div id="global-stats" class="flex gap-6">
                <!-- Global stats will be injected here -->
            </div>
        </header>

        <!-- Main Content -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Battlefield (Center) -->
            <main class="flex-1 p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-teko text-4xl text-slate-300">üî• ACTIVE COMBAT ZONE</h2>
                    <button id="add-chapter-btn" class="bg-cyan-500 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-cyan-400 transition">Activate New Chapter</button>
                </div>
                <div id="chapters-container" class="grid grid-cols-1 lg:grid-cols-2 2xl:grid-cols-3 gap-6">
                    <!-- Chapter cards will be injected here -->
                </div>
            </main>

            <!-- Command & Control (Right Sidebar) -->
            <aside class="w-96 flex-shrink-0 bg-slate-950/70 backdrop-blur-sm border-l border-slate-800 p-6 flex flex-col">
                <div id="chimera-engine" class="chimera-card p-4 rounded-lg mb-6">
                    <h3 class="font-teko text-3xl text-cyan-400">CHIMERA ENGINE</h3>
                    <p class="text-sm text-slate-400 mb-4">AI has analyzed the battlefield. Prioritize these targets.</p>
                    <div id="next-test-syllabus" class="space-y-2"></div>
                </div>
                <div id="fortress-hall" class="chimera-card p-4 rounded-lg flex-1 flex flex-col">
                    <h3 class="font-teko text-3xl text-lime-400">üèõÔ∏è FORTRESS HALL</h3>
                    <div id="fortress-container" class="mt-4 space-y-2 overflow-y-auto flex-1"></div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Modals -->
    <div id="add-chapter-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden">
        <div class="chimera-card rounded-lg p-8 w-full max-w-md">
            <h2 class="font-teko text-3xl mb-4">Activate New Chapter</h2>
            <select id="chapter-select" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:border-cyan-400 mb-4"></select>
            <div class="flex gap-4">
                <button id="modal-cancel-btn" class="w-full bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-lg">Cancel</button>
                <button id="modal-activate-btn" class="w-full bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-bold py-3 rounded-lg">Activate</button>
            </div>
        </div>
    </div>
    
    <div id="add-score-modal" class="fixed inset-0 modal-backdrop flex items-center justify-center hidden">
        <div class="chimera-card rounded-lg p-8 w-full max-w-md">
            <h2 id="score-modal-title" class="font-teko text-3xl mb-4">Add Score</h2>
            <input type="number" id="score-input-field" min="0" max="100" class="w-full text-center text-2xl font-bold bg-slate-800 border border-slate-700 rounded-lg p-3 focus:outline-none focus:border-cyan-400 mb-4" placeholder="Enter % Score">
            <div class="flex gap-4">
                <button id="score-modal-cancel-btn" class="w-full bg-slate-700 hover:bg-slate-600 font-bold py-3 rounded-lg">Cancel</button>
                <button id="score-modal-submit-btn" class="w-full bg-cyan-500 hover:bg-cyan-400 text-slate-900 font-bold py-3 rounded-lg">Submit Score</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const initialChapters = [
        'Some Basic Concepts', 'Structure of Atom', 'States of Matter', 'Thermodynamics', 'Equilibrium', 'Redox Reactions', 'Solid State', 'Solutions', 'Electrochemistry', 'Chemical Kinetics', 'Surface Chemistry', 'Periodic Table', 'Chemical Bonding', 'Hydrogen', 's-Block Elements', 'p-Block (13-14)', 'p-Block (15-18)', 'd & f Block', 'Coordination Compounds', 'Metallurgy', 'GOC & Hydrocarbons', 'Environmental Chemistry', 'Haloalkanes & Haloarenes', 'Alcohols, Phenols & Ethers', 'Aldehydes, Ketones & Acids', 'Amines', 'Biomolecules', 'Polymers', 'Chemistry in Everyday Life'
    ].map((name, index) => ({ id: `c${index + 1}`, name, status: 'locked', scores: [], lastTested: null }));

    let chapterData = JSON.parse(localStorage.getItem('chimeraV2Data')) || initialChapters;
    let currentlyScoringChapterId = null;

    // DOM Elements
    const elements = {
        chaptersContainer: document.getElementById('chapters-container'),
        nextTestSyllabus: document.getElementById('next-test-syllabus'),
        fortressContainer: document.getElementById('fortress-container'),
        chapterSelect: document.getElementById('chapter-select'),
        globalStats: document.getElementById('global-stats'),
        // Modals
        addChapterModal: document.getElementById('add-chapter-modal'),
        addChapterBtn: document.getElementById('add-chapter-btn'),
        modalActivateBtn: document.getElementById('modal-activate-btn'),
        modalCancelBtn: document.getElementById('modal-cancel-btn'),
        addScoreModal: document.getElementById('add-score-modal'),
        scoreModalTitle: document.getElementById('score-modal-title'),
        scoreInputField: document.getElementById('score-input-field'),
        scoreModalSubmitBtn: document.getElementById('score-modal-submit-btn'),
        scoreModalCancelBtn: document.getElementById('score-modal-cancel-btn'),
    };

    function saveData() {
        localStorage.setItem('chimeraV2Data', JSON.stringify(chapterData));
    }

    // --- Core AI Logic ---
    function calculateWeaknessScore(chapter) {
        if (chapter.status !== 'active') return -1;

        const avgScore = chapter.scores.length ? chapter.scores.reduce((a, b) => a + b, 0) / chapter.scores.length : 0;
        const weight_avg = 1.5; // Lower score is a bigger weakness

        const recency = chapter.lastTested ? (Date.now() - chapter.lastTested) / (1000 * 60 * 60 * 24) : 0; // Days since last test
        const weight_recency = 0.5; // Older test is a weakness

        const attempts = chapter.scores.length;
        const weight_attempts = 1; // Fewer attempts is a weakness

        const weakness = ((100 - avgScore) * weight_avg) + (recency * weight_recency) + ((5 - attempts > 0 ? 5 - attempts : 0) * weight_attempts);
        return weakness;
    }

    function getNextMissionSyllabus() {
        const activeChapters = chapterData.filter(c => c.status === 'active');
        if (activeChapters.length === 0) return [];
        
        activeChapters.forEach(c => c.weakness = calculateWeaknessScore(c));
        activeChapters.sort((a, b) => b.weakness - a.weakness);

        return activeChapters.slice(0, 3);
    }
    
    // --- Rendering Logic ---
    function render() {
        // Clear containers
        elements.chaptersContainer.innerHTML = '';
        elements.fortressContainer.innerHTML = '';
        elements.chapterSelect.innerHTML = '<option value="">Activate a New Chapter...</option>';
        
        let activeCount = 0, fortressCount = 0;

        chapterData.forEach(chapter => {
            if (chapter.scores.length >= 3 && chapter.scores.slice(-3).every(s => s >= 90)) {
                chapter.status = 'fortress';
            } else if (chapter.status !== 'locked') {
                chapter.status = 'active';
            }

            if (chapter.status === 'locked') {
                const option = document.createElement('option');
                option.value = chapter.id;
                option.textContent = chapter.name;
                elements.chapterSelect.appendChild(option);
            } else if (chapter.status === 'active') {
                activeCount++;
                elements.chaptersContainer.innerHTML += renderChapterCard(chapter);
            } else {
                fortressCount++;
                elements.fortressContainer.innerHTML += renderFortressCard(chapter);
            }
        });

        if (activeCount === 0) elements.chaptersContainer.innerHTML = '<p class="text-slate-500 text-center col-span-full">No active battles. Activate a chapter.</p>';
        if (fortressCount === 0) elements.fortressContainer.innerHTML = '<p class="text-slate-500 text-center">No fortresses built yet.</p>';

        renderGlobalStats(chapterData.length, activeCount, fortressCount);
        renderNextTestSyllabus();
        saveData();
    }

    function renderGlobalStats(total, active, fortresses) {
        elements.globalStats.innerHTML = `
            <div class="text-center"><p class="font-teko text-3xl">${total}</p><p class="text-xs text-slate-400">Total Chapters</p></div>
            <div class="text-center"><p class="font-teko text-3xl text-yellow-300">${active}</p><p class="text-xs text-slate-400">Active Battles</p></div>
            <div class="text-center"><p class="font-teko text-3xl text-lime-400">${fortresses}</p><p class="text-xs text-slate-400">Fortresses</p></div>
        `;
    }

    function renderNextTestSyllabus() {
        const syllabus = getNextMissionSyllabus();
        elements.nextTestSyllabus.innerHTML = '';
        if (syllabus.length === 0) {
            elements.nextTestSyllabus.innerHTML = '<p class="text-sm text-slate-500">Activate up to 3 chapters to generate a mission.</p>';
            return;
        }
        const roles = ['üéØ Spearhead', 'üõ°Ô∏è Support', 'üî≠ Long-Range'];
        syllabus.forEach((chapter, index) => {
            elements.nextTestSyllabus.innerHTML += `
                <div class="bg-slate-900/70 p-3 rounded-lg border-l-4 border-cyan-400">
                    <p class="font-semibold text-slate-200">${chapter.name}</p>
                    <p class="text-xs font-bold text-cyan-400">${roles[index]}</p>
                </div>
            `;
        });
    }

    function renderChapterCard(chapter) {
        const fortressProgress = chapter.scores.slice(-3).filter(s => s >= 90).length;
        const progressPercentage = (fortressProgress / 3) * 100;
        const avgScore = chapter.scores.length ? (chapter.scores.reduce((a, b) => a + b, 0) / chapter.scores.length).toFixed(1) : 'N/A';

        return `
            <div class="chimera-card p-5 rounded-lg">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="font-bold text-xl text-slate-200 pr-2">${chapter.name}</h3>
                    <button class="add-score-btn text-2xl font-bold text-cyan-400 hover:text-cyan-300" data-id="${chapter.id}">+</button>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                    <div><span class="text-slate-400">Avg Score:</span> <span class="font-bold text-white">${avgScore}%</span></div>
                    <div><span class="text-slate-400">Attempts:</span> <span class="font-bold text-white">${chapter.scores.length}</span></div>
                </div>
                <div class="w-full progress-bg rounded-full h-2 mb-1">
                    <div class="progress-bar h-2 rounded-full" style="width: ${progressPercentage}%"></div>
                </div>
                <p class="text-xs text-slate-400">Fortress Progress (${fortressProgress}/3)</p>
                <div class="mt-3 h-10 w-full">
                    <canvas class="sparkline-chart" data-scores="${chapter.scores.join(',')}"></canvas>
                </div>
            </div>
        `;
    }
    
    function renderFortressCard(chapter){
        return `<div class="bg-slate-800/30 p-2 rounded flex items-center gap-2 text-sm"><span class="text-lime-400">üè∞</span><span class="font-semibold text-slate-300">${chapter.name}</span></div>`;
    }

    function renderSparklines() {
        document.querySelectorAll('.sparkline-chart').forEach(canvas => {
            const scores = canvas.dataset.scores.split(',').map(s => Number(s)).filter(s => !isNaN(s));
            if (scores.length < 2) return;
            new Chart(canvas.getContext('2d'), {
                type: 'line',
                data: {
                    labels: Array(scores.length).fill(''),
                    datasets: [{
                        data: scores,
                        borderColor: '#94a3b8',
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { x: { display: false }, y: { display: false, min: 0, max: 100 } },
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                }
            });
        });
    }

    // --- Event Listeners ---
    function toggleModal(modal, show) {
        if (show) modal.classList.remove('hidden');
        else modal.classList.add('hidden');
    }

    elements.addChapterBtn.addEventListener('click', () => toggleModal(elements.addChapterModal, true));
    elements.modalCancelBtn.addEventListener('click', () => toggleModal(elements.addChapterModal, false));
    elements.modalActivateBtn.addEventListener('click', () => {
        const selectedId = elements.chapterSelect.value;
        if (!selectedId) return;
        const chapter = chapterData.find(c => c.id === selectedId);
        chapter.status = 'active';
        chapter.activationTime = Date.now();
        toggleModal(elements.addChapterModal, false);
        render();
        renderSparklines();
    });

    elements.chaptersContainer.addEventListener('click', e => {
        if (e.target.classList.contains('add-score-btn')) {
            currentlyScoringChapterId = e.target.dataset.id;
            const chapter = chapterData.find(c => c.id === currentlyScoringChapterId);
            elements.scoreModalTitle.textContent = `Add Score for ${chapter.name}`;
            elements.scoreInputField.value = '';
            toggleModal(elements.addScoreModal, true);
            elements.scoreInputField.focus();
        }
    });
    
    elements.scoreModalCancelBtn.addEventListener('click', () => toggleModal(elements.addScoreModal, false));
    elements.scoreModalSubmitBtn.addEventListener('click', () => {
        const score = parseInt(elements.scoreInputField.value);
        if (currentlyScoringChapterId && !isNaN(score) && score >= 0 && score <= 100) {
            const chapter = chapterData.find(c => c.id === currentlyScoringChapterId);
            chapter.scores.push(score);
            chapter.lastTested = Date.now();
            toggleModal(elements.addScoreModal, false);
            render();
            renderSparklines();
        }
    });
    
    // Initial render
    render();
    renderSparklines();
});
</script>
</body>
</html>
